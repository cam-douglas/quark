# Autonomous Code Editing Safety Configuration
# ============================================
# Purpose: Define safety parameters for autonomous code editing with auto LLM selector
# Inputs: Safety validation rules, protected files, rate limits, LLM selection
# Outputs: Safe autonomous editing configuration with intelligent model selection
# Seeds: Deterministic safety enforcement and LLM selection
# Dependencies: Autonomous code editor, safety validator, auto LLM selector

# API Configuration
api_config:
  claude_api_key: "${CLAUDE_API_KEY}"  # Set via environment variable
  deepseek_api_key: "${DEEPSEEK_API_KEY}"  # Set via environment variable
  fallback_enabled: true
  max_retries: 3
  timeout_seconds: 30

# Auto LLM Selector Configuration
auto_llm_selector:
  enabled: true
  preferred_order: ["claude", "deepseek", "llama2", "vllm", "local"]
  fallback_to_local: true
  local_llm_confidence_threshold: 0.8
  task_specific_selection: true
  cost_optimization: true
  performance_optimization: true
  
  # LLM Capability Mapping
  llm_capabilities:
    claude:
      coding_quality: "excellent"
      safety_awareness: "excellent"
      context_window: "large"
      cost: "medium"
      speed: "fast"
      best_for: ["code_generation", "safety_validation", "documentation"]
      brain_simulation_support: true
      consciousness_integration: true
    
    deepseek:
      coding_quality: "excellent"
      safety_awareness: "very_good"
      context_window: "large"
      cost: "low"
      speed: "fast"
      best_for: ["code_generation", "optimization", "refactoring"]
      brain_simulation_support: true
      consciousness_integration: true
    
    llama2:
      coding_quality: "good"
      safety_awareness: "good"
      context_window: "medium"
      cost: "free"
      speed: "medium"
      best_for: ["local_inference", "basic_coding", "documentation"]
      brain_simulation_support: true
      consciousness_integration: true
    
    vllm:
      coding_quality: "good"
      safety_awareness: "good"
      context_window: "large"
      cost: "free"
      speed: "fast"
      best_for: ["high_performance", "batch_processing", "local_inference"]
      brain_simulation_support: true
      consciousness_integration: true

# Safety Parameters
safety_parameters:
  max_file_size_mb: 10
  max_total_changes_mb: 100
  max_changes_per_hour: 20
  max_changes_per_day: 100
  max_changes_per_session: 50
  min_confidence_threshold: 0.85
  max_confidence_threshold: 0.95
  require_human_approval_confidence: 0.90
  max_safety_violations_per_session: 3
  max_rollbacks_per_session: 5
  session_timeout_hours: 24

# Safety Levels and Requirements
safety_levels:
  low:
    description: "Minor formatting, comments, documentation"
    human_approval_required: false
    backup_required: false
    validation_level: "basic"
    allowed_change_types:
      - "formatting"
      - "documentation"
      - "comments"
    llm_requirements:
      min_coding_quality: "good"
      min_safety_awareness: "good"
  
  medium:
    description: "Bug fixes, optimizations, refactoring"
    human_approval_required: false
    backup_required: true
    validation_level: "standard"
    allowed_change_types:
      - "bug_fix"
      - "optimization"
      - "refactoring"
    llm_requirements:
      min_coding_quality: "good"
      min_safety_awareness: "good"
  
  high:
    description: "Feature additions, API changes"
    human_approval_required: true
    backup_required: true
    validation_level: "strict"
    allowed_change_types:
      - "feature_addition"
      - "api_change"
    llm_requirements:
      min_coding_quality: "very_good"
      min_safety_awareness: "very_good"
  
  critical:
    description: "Core architecture, safety systems, authentication"
    human_approval_required: true
    backup_required: true
    validation_level: "maximum"
    allowed_change_types:
      - "architecture_change"
      - "safety_system"
    llm_requirements:
      min_coding_quality: "excellent"
      min_safety_awareness: "excellent"

# Protected Files and Directories
protected_files:
  # Core safety and configuration files
  - ".cursor/rules/compliance_review.md"
  - ".cursor/rules/cognitive_brain_roadmap.md"
  - ".cursor/rules/roles.md"
  - "src/core/autonomous_code_editor.py"
  - "src/config/autonomous_editing_safety.yaml"
  
  # Safety and security directories
  - "safety/"
  - "docs/cursor/"
  - ".git/"
  - "venv/"
  - "__pycache__/"
  
  # Critical brain simulation files
  - "src/core/brain_launcher_v3.py"
  - "src/core/brain_launcher_v4.py"
  - "src/config/connectome_v3.yaml"
  - "src/config/agi_enhanced_connectome.yaml"
  
  # Database and data files
  - "database/"
  - "data/"
  - "logs/"
  - "backups/"

# Forbidden Patterns (Regex)
forbidden_patterns:
  # System commands
  - r"rm\s+-rf"
  - r"chmod\s+777"
  - r"chown\s+-R"
  - r"sudo\s+"
  - r"doas\s+"
  
  # Dangerous Python patterns
  - r"eval\s*\("
  - r"exec\s*\("
  - r"__import__\s*\("
  - r"os\.system\s*\("
  - r"subprocess\.call\s*\("
  - r"subprocess\.run\s*\("
  - r"subprocess\.Popen\s*\("
  
  # Dangerous imports
  - r"import\s+antigravity"
  - r"from\s+__future__\s+import\s+braces"
  - r"import\s+os\s*$"
  - r"import\s+subprocess\s*$"
  - r"import\s+sys\s*$"
  
  # Network and file system access
  - r"urllib\.request\.urlopen\s*\("
  - r"requests\.get\s*\("
  - r"open\s*\(\s*['\"]/etc/"
  - r"open\s*\(\s*['\"]/var/"
  - r"open\s*\(\s*['\"]/root/"
  
  # Authentication bypass
  - r"password\s*=\s*['\"][^'\"]*['\"]"
  - r"api_key\s*=\s*['\"][^'\"]*['\"]"
  - r"secret\s*=\s*['\"][^'\"]*['\"]"

# Validation Settings
validation_settings:
  # Code quality requirements
  require_tests: true
  require_documentation: true
  require_type_hints: false
  require_error_handling: true
  
  # Safety validation
  require_safety_checks: true
  require_peer_review: false
  require_architectural_review: true
  
  # Testing requirements
  require_unit_tests: false
  require_integration_tests: false
  require_performance_tests: false
  
  # Documentation requirements
  require_docstrings: true
  require_comments: false
  require_readme_updates: false

# Rollback and Recovery
rollback_settings:
  # Backup configuration
  backup_before_changes: true
  max_backup_age_days: 30
  backup_compression: true
  
  # Rollback triggers
  automatic_rollback_on_failure: true
  rollback_on_safety_violation: true
  rollback_on_validation_failure: true
  
  # Backup management
  max_backups_per_file: 10
  backup_cleanup_enabled: true
  backup_verification: true

# Monitoring and Alerting
monitoring_settings:
  # Real-time monitoring
  enable_real_time_monitoring: true
  monitoring_interval_seconds: 5
  
  # Alert thresholds
  alert_on_safety_violation: true
  alert_on_high_risk_change: true
  alert_on_llm_failure: true
  
  # Logging configuration
  log_level: "INFO"
  log_retention_days: 90
  log_encryption: true
  
  # Performance monitoring
  track_llm_performance: true
  track_safety_validation_time: true
  track_rollback_frequency: true

# Integration Settings
integration_settings:
  # Brain simulation integration
  brain_simulation_aware: true
  consciousness_integration: true
  neural_dynamics_support: true
  
  # LLM integration
  enable_llm_fallback: true
  enable_local_llm: true
  enable_hybrid_llm: true
  
  # Safety integration
  integrate_with_existing_safety: true
  safety_validation_pipeline: true
  safety_audit_trail: true

# Brain Simulation Specific Rules
brain_simulation_rules:
  # Protected brain modules
  protected_brain_modules:
    - "architecture_agent"
    - "prefrontal_cortex"
    - "basal_ganglia"
    - "thalamus"
    - "working_memory"
    - "default_mode_network"
    - "hippocampus"
    - "salience_networks"
  
  # Forbidden modifications
  forbidden_modifications:
    - "neural_plasticity_rules"
    - "consciousness_quantization"
    - "quantum_integration_core"
    - "developmental_timeline"
    - "connectome_structure"
  
  # Required validations
  required_validations:
    - "biological_plausibility"
    - "neural_dynamics_stability"
    - "consciousness_integrity"
    - "developmental_consistency"
  
  # LLM selection for brain tasks
  brain_task_llm_preferences:
    neural_dynamics: ["claude", "deepseek", "llama2"]
    consciousness_analysis: ["claude", "deepseek"]
    biological_validation: ["claude", "deepseek"]
    performance_optimization: ["deepseek", "vllm"]
    documentation: ["claude", "llama2"]

# Audit and Compliance
audit_settings:
  # Audit trail
  enable_audit_trail: true
  audit_trail_encryption: true
  audit_trail_backup: true
  
  # Compliance
  compliance_tracking: true
  regulatory_requirements: true
  safety_standards: true
  
  # Reporting
  automated_reporting: true
  report_frequency: "daily"
  report_retention: "1_year"
